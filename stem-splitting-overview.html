<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Stem Splitting Pipeline</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300..900;1,9..144,300..900&family=Source+Code+Pro:wght@400;600&family=Source+Sans+3:wght@400;600&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap');

:root {
  --font-display: 'Fraunces', Georgia, serif;
  --font-body: 'Source Serif 4', Georgia, serif;
  --font-body-sans: 'Source Sans 3', system-ui, sans-serif;
  --font-mono: 'Source Code Pro', monospace;

  --color-ink: #2c2825;
  --color-ink-soft: #5c5550;
  --color-ink-muted: #8a8580;
  --color-cream: #f7f5f2;
  --color-paper: #faf9f7;
  --color-linen: #f0ede8;
  --teal-standard: #4b7c8c;
  --teal-deep: #1a3a40;
  --teal-pale: #b8d4dc;
  --ember-terracotta: #c4704b;

  --color-text: var(--color-ink);
  --color-text-soft: var(--color-ink-soft);
  --color-text-muted: var(--color-ink-muted);
  --color-background: var(--color-paper);
  --color-surface: var(--color-cream);
  --color-surface-raised: var(--color-linen);
  --color-accent: var(--teal-standard);
  --color-accent-deep: var(--teal-deep);
  --color-accent-pale: var(--teal-pale);
  --color-callout: var(--ember-terracotta);

  --space-xs: 8px;
  --space-sm: 12px;
  --space-md: 20px;
  --space-lg: 32px;
  --space-xl: 48px;
  --space-xxl: 64px;

  --shadow-soft: 0 2px 8px hsla(25, 40%, 30%, 0.08);
  --shadow-lifted: 0 4px 16px hsla(25, 40%, 30%, 0.12);
}

* { box-sizing: border-box; }

body {
  font-family: var(--font-body);
  font-size: 16px;
  line-height: 1.6;
  color: var(--color-text);
  background: var(--color-background);
  margin: 0;
  padding: var(--space-lg) var(--space-md);
}

.container { max-width: 820px; margin: 0 auto; }

h1, h2, h3, h4 {
  font-family: var(--font-display);
  line-height: 1.2;
  margin: 0 0 var(--space-md) 0;
  font-weight: 600;
  color: var(--color-text);
}

h1 {
  font-size: 42px;
  margin-bottom: var(--space-sm);
  font-variation-settings: 'opsz' 144;
}

.subtitle {
  font-family: var(--font-body-sans);
  font-size: 18px;
  color: var(--color-text-soft);
  margin: 0 0 var(--space-xl) 0;
  font-weight: 400;
}

h2 {
  font-size: 32px;
  margin-top: var(--space-xxl);
  padding-bottom: var(--space-sm);
  border-bottom: 2px solid var(--color-linen);
  font-variation-settings: 'opsz' 96;
}

h3 {
  font-size: 24px;
  margin-top: var(--space-lg);
  color: var(--color-ink-soft);
}

h4 {
  font-size: 18px;
  margin-top: var(--space-md);
  color: var(--color-ink-soft);
}

p { margin: 0 0 var(--space-md) 0; }
ul, ol { margin: 0 0 var(--space-md) 0; padding-left: var(--space-lg); }
li { margin-bottom: var(--space-xs); }

strong { font-weight: 600; }

code {
  font-family: var(--font-mono);
  font-size: 14px;
  background: var(--color-linen);
  padding: 2px 6px;
  border-radius: 3px;
  color: var(--color-accent-deep);
}

pre {
  font-family: var(--font-mono);
  font-size: 14px;
  line-height: 1.5;
  background: var(--color-linen);
  padding: var(--space-md);
  border-radius: 8px;
  border: 1px solid var(--color-surface-raised);
  overflow-x: auto;
  margin: 0 0 var(--space-md) 0;
  box-shadow: var(--shadow-soft);
}

pre code {
  background: none;
  padding: 0;
  color: var(--color-text);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--space-md) 0 var(--space-lg) 0;
  background: var(--color-surface);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: var(--shadow-soft);
}

thead { background: var(--color-accent); color: white; }

th, td {
  text-align: left;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--color-linen);
}

th {
  font-family: var(--font-body-sans);
  font-weight: 600;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

td { font-size: 15px; }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: var(--color-cream); }
td code { font-size: 13px; }

.callout {
  background: var(--color-cream);
  border-left: 4px solid var(--color-callout);
  padding: var(--space-md) var(--space-md) var(--space-md) var(--space-lg);
  margin: var(--space-lg) 0;
  border-radius: 6px;
  box-shadow: var(--shadow-soft);
}

.callout h4 {
  margin-top: 0;
  color: var(--color-callout);
  font-size: 16px;
  font-family: var(--font-body-sans);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.callout p:last-child, .callout ul:last-child, .callout pre:last-child { margin-bottom: 0; }

.flow-step {
  background: var(--color-surface);
  padding: var(--space-md);
  margin: var(--space-sm) 0;
  border-radius: 8px;
  border-left: 4px solid var(--color-accent);
  box-shadow: var(--shadow-soft);
}

.flow-step-header {
  font-family: var(--font-body-sans);
  font-weight: 600;
  color: var(--color-accent-deep);
  margin-bottom: var(--space-xs);
  font-size: 15px;
}

.flow-step-tool {
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--color-accent);
  margin-bottom: var(--space-xs);
}

.flow-step-description {
  color: var(--color-text-soft);
  font-size: 15px;
  margin: 0;
}

.folder-structure {
  background: var(--color-linen);
  padding: var(--space-md);
  border-radius: 8px;
  border: 1px solid var(--color-surface-raised);
  margin: var(--space-md) 0;
  font-family: var(--font-mono);
  font-size: 14px;
  line-height: 1.8;
  box-shadow: var(--shadow-soft);
}

.folder-structure .folder { color: var(--color-accent); font-weight: 600; }
.folder-structure .comment { color: var(--color-text-muted); }

header {
  border-bottom: 3px solid var(--color-linen);
  padding-bottom: var(--space-lg);
  margin-bottom: var(--space-xl);
}

/* Download buttons */
.download-group {
  display: flex;
  gap: var(--space-md);
  flex-wrap: wrap;
  margin: var(--space-lg) 0;
}

.download-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-family: var(--font-body-sans);
  font-size: 15px;
  font-weight: 600;
  color: white;
  background: var(--color-accent);
  border: none;
  padding: 14px 24px;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  min-height: 48px;
  box-shadow: var(--shadow-soft);
  transition: background 0.15s ease, box-shadow 0.15s ease;
}

.download-btn:hover, .download-btn:focus-visible {
  background: var(--color-accent-deep);
  box-shadow: var(--shadow-lifted);
}

.download-btn:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.download-btn svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.download-btn-secondary {
  background: var(--color-callout);
}

.download-btn-secondary:hover, .download-btn-secondary:focus-visible {
  background: #a85e3e;
}

/* Quick start section */
.quick-start {
  background: var(--color-surface);
  border: 2px solid var(--color-accent-pale);
  border-radius: 12px;
  padding: var(--space-lg);
  margin: var(--space-lg) 0;
  box-shadow: var(--shadow-soft);
}

.quick-start h3 {
  margin-top: 0;
  color: var(--color-accent-deep);
}

.quick-start ol {
  font-family: var(--font-body-sans);
  margin-bottom: 0;
}

.quick-start li { margin-bottom: var(--space-sm); }

@media print {
  body { background: white; padding: 0; }
  .callout, table { break-inside: avoid; }
  h2, h3 { break-after: avoid; }
  .download-group { display: none; }
}

@media (max-width: 600px) {
  body { padding: var(--space-md) var(--space-sm); }
  h1 { font-size: 32px; }
  h2 { font-size: 26px; }
  table { font-size: 13px; }
  th, td { padding: var(--space-xs) var(--space-sm); }
  .download-group { flex-direction: column; }
  .download-btn { justify-content: center; }
}
</style>
</head>
<body>

<div class="container">

<header>
  <h1>Audio Stem Splitting Pipeline</h1>
  <p class="subtitle">Separate vocals from instrumentals, produce practice tracks at multiple vocal levels, and automate the whole thing with an LLM.</p>
</header>

<section>
  <h2>Get Started</h2>

  <p>This page describes a pipeline that takes any song, splits it into vocals and instrumentals using AI, then produces practice-ready tracks at four vocal levels (full, half, ghost, karaoke). It runs locally on a Mac, processes a typical 12-song show in under an hour, and every step is automated.</p>

  <p>You can replicate it in about 15 minutes. Download the setup script to install the tools, then paste the prompt into Claude Code (or any coding LLM) and it will generate a customized pipeline for your songs.</p>

  <div class="download-group">
    <button class="download-btn" onclick="downloadSetup()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      Download Setup Script
    </button>
    <button class="download-btn download-btn-secondary" onclick="downloadPrompt()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      Download LLM Prompt
    </button>
  </div>

  <div class="quick-start">
    <h3>Quick Start</h3>
    <ol>
      <li>Run <code>bash stem-setup.sh</code> to install Demucs, FFmpeg, and yt-dlp</li>
      <li>Open <code>stem-pipeline-prompt.md</code> and fill in your song list (name + YouTube URL)</li>
      <li>Paste the prompt into Claude Code, Cursor, or any coding LLM</li>
      <li>The LLM generates a pipeline script customized to your songs</li>
      <li>Run the script step-by-step: <code>./pipeline.sh step1</code>, <code>./pipeline.sh step2</code>, etc.</li>
    </ol>
  </div>
</section>

<section>
  <h2>What the Pipeline Produces</h2>

  <p>For each song, the pipeline outputs four versions at different vocal levels. Students (or anyone practicing) can switch between them as they learn:</p>

  <table>
    <thead>
      <tr>
        <th>Track</th>
        <th>Vocals</th>
        <th>Use</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Full Mix</strong></td>
        <td>100%</td>
        <td>Learn the song, hear everything</td>
      </tr>
      <tr>
        <td><strong>Half Vox</strong></td>
        <td>50%</td>
        <td>Practice with vocal support</td>
      </tr>
      <tr>
        <td><strong>Ghost Vox</strong></td>
        <td>10%</td>
        <td>Near-solo, faint guide in the background</td>
      </tr>
      <tr>
        <td><strong>Karaoke</strong></td>
        <td>0%</td>
        <td>Performance mode, instrumentals only</td>
      </tr>
    </tbody>
  </table>

  <p>The half and ghost mixes are generated by mixing the isolated instrumental track with the vocal track at reduced volume. All four versions are normalized to -14 LUFS so they play at the same perceived loudness.</p>
</section>

<section>
  <h2>How It Works</h2>

  <p>The pipeline has 7 steps. Steps 3-5 are optional depending on your needs. Each step is idempotent — re-running it skips any work that's already done.</p>

  <div class="flow-step">
    <div class="flow-step-header">Step 0: Environment Check</div>
    <div class="flow-step-tool">bash</div>
    <div class="flow-step-description">Verifies all required tools are installed. Exits early with install instructions if anything is missing.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 1: Download Source Audio</div>
    <div class="flow-step-tool">yt-dlp</div>
    <div class="flow-step-description">Downloads audio from YouTube URLs as high-quality WAV. ~1-2 minutes for a full show.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 2: Stem Separation</div>
    <div class="flow-step-tool">Demucs (htdemucs model)</div>
    <div class="flow-step-description">AI splits each song into vocals.wav + no_vocals.wav. ~1-2 minutes per song on Apple Silicon.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 3: Pitch Shift (optional)</div>
    <div class="flow-step-tool">Rubber Band</div>
    <div class="flow-step-description">Transpose vocals and instrumentals separately to match a performer's range. ~10-20 seconds per stem.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 4: Cut and Splice (optional)</div>
    <div class="flow-step-tool">FFmpeg</div>
    <div class="flow-step-description">Trim intros, remove sections, reorder segments. Timestamps defined in a config file.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 5: Lead/Backing Separation (optional)</div>
    <div class="flow-step-tool">audio-separator</div>
    <div class="flow-step-description">Further split the vocal track into lead vs backing vocals. Useful for ensemble pieces.</div>
  </div>

  <div class="flow-step">
    <div class="flow-step-header">Step 6: Mix, Normalize, and Export</div>
    <div class="flow-step-tool">FFmpeg</div>
    <div class="flow-step-description">Generate Full/Half/Ghost/Karaoke versions, two-pass normalize to -14 LUFS, export final files.</div>
  </div>
</section>

<section>
  <h2>The Core Tool: Demucs</h2>

  <p><strong>Demucs</strong> is Meta's open-source AI model for audio source separation. It runs locally (no cloud, no API keys) and produces clean vocal/instrumental splits on most music.</p>

  <h3>Key Command</h3>

  <pre><code>demucs --two-stems vocals -n htdemucs "source.wav"</code></pre>

  <ul>
    <li><code>--two-stems vocals</code> — Split into vocals vs. everything else. Almost always the right choice for practice tracks.</li>
    <li><code>-n htdemucs</code> — Hybrid Transformer model. Good default for most music.</li>
    <li><code>-n htdemucs_ft</code> — Fine-tuned variant. Slower, but better on orchestral, choral, or dense mixes.</li>
  </ul>

  <h3>Alternatives</h3>

  <table>
    <thead>
      <tr>
        <th>Tool</th>
        <th>Best For</th>
        <th>Cost</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Demucs</strong></td>
        <td>Scriptable, local, free, integrates into automation</td>
        <td>Free</td>
      </tr>
      <tr>
        <td><strong>Lalal.ai Phoenix</strong></td>
        <td>Orchestral music, highest quality on complex arrangements</td>
        <td>Subscription</td>
      </tr>
      <tr>
        <td><strong>Moises.ai</strong></td>
        <td>Musicians who want a GUI with pitch/tempo control built in</td>
        <td>Freemium</td>
      </tr>
      <tr>
        <td><strong>Logic Pro</strong></td>
        <td>Quick one-offs if you already own Logic</td>
        <td>One-time</td>
      </tr>
    </tbody>
  </table>
</section>

<section>
  <h2>Folder Structure</h2>

  <p>Each step reads from the previous folder and writes to its own. This makes it easy to spot-check intermediate outputs and re-run any single step without redoing everything.</p>

  <div class="folder-structure">
<span class="folder">Production/</span>
  <span class="folder">01-Source/</span>          <span class="comment"># Downloaded WAV files</span>
  <span class="folder">02-Stems/</span>           <span class="comment"># Demucs output: vocals.wav + no_vocals.wav per song</span>
  <span class="folder">03-Shifted/</span>         <span class="comment"># Pitch-shifted variants (if needed)</span>
  <span class="folder">04-Cut/</span>             <span class="comment"># Trimmed/spliced versions (if needed)</span>
  <span class="folder">05-Lead-Backing/</span>    <span class="comment"># Lead vs backing vocals (if needed)</span>
  <span class="folder">06-Final/</span>           <span class="comment"># Normalized Full/Half/Ghost/Karaoke exports</span>
  <span class="folder">logs/</span>               <span class="comment"># Per-step, per-song log files</span>
  </div>
</section>

<section>
  <h2>Things That Will Save You Time</h2>

  <div class="callout">
    <h4>Pitch shift the stems, not the mix</h4>
    <p>If you need to change a song's key, shift the vocals and instrumentals separately, then recombine. Shifting the full mix produces noticeably worse artifacts.</p>
  </div>

  <div class="callout">
    <h4>Two-pass loudnorm</h4>
    <p>FFmpeg's <code>loudnorm</code> filter needs two passes to hit its target. Pass 1 measures, pass 2 corrects with the measured values. Single-pass consistently overshoots by 1-2 LUFS, which means some songs will be noticeably louder than others.</p>
  </div>

  <div class="callout">
    <h4>normalize=0 when mixing vocal levels</h4>
    <p>When generating half/ghost mixes with <code>amix</code>, add <code>normalize=0</code>. Without it, FFmpeg auto-reduces the instrumental volume to "make room" for the quiet vocals, making the backing track too soft.</p>
    <pre><code>ffmpeg -i no_vocals.wav -i vocals.wav \
  -filter_complex "[1:a]volume=0.5[v];[0:a][v]amix=inputs=2:duration=first:normalize=0" \
  half_vox.wav</code></pre>
  </div>

  <div class="callout">
    <h4>Formant preservation for big pitch shifts</h4>
    <p>Rubber Band's <code>--formant</code> flag prevents chipmunk (up) or monster (down) effects. Enable it automatically for shifts of 3+ semitones.</p>
  </div>

  <div class="callout">
    <h4>Two-stem mode is almost always right</h4>
    <p>Demucs can do 4-stem separation (vocals/drums/bass/other), but for practice tracks you just need "voice" vs "not voice." Two-stem mode is faster, simpler, and sounds better when recombined.</p>
  </div>
</section>

<section>
  <h2>Tools Reference</h2>

  <table>
    <thead>
      <tr>
        <th>Tool</th>
        <th>Purpose</th>
        <th>Install</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Demucs</strong></td>
        <td>AI vocal/instrumental separation</td>
        <td><code>pip install demucs</code> (in a venv)</td>
      </tr>
      <tr>
        <td><strong>yt-dlp</strong></td>
        <td>YouTube audio download</td>
        <td><code>brew install yt-dlp</code></td>
      </tr>
      <tr>
        <td><strong>FFmpeg</strong></td>
        <td>Audio conversion, mixing, normalization, cutting</td>
        <td><code>brew install ffmpeg</code></td>
      </tr>
      <tr>
        <td><strong>Rubber Band</strong></td>
        <td>Pitch shifting with formant preservation</td>
        <td><code>brew install rubberband</code></td>
      </tr>
      <tr>
        <td><strong>audio-separator</strong></td>
        <td>Lead/backing vocal separation (optional)</td>
        <td><code>pip install audio-separator[cpu]</code></td>
      </tr>
    </tbody>
  </table>

  <h3>System Requirements</h3>
  <ul>
    <li><strong>macOS</strong> 11.0+ (Intel or Apple Silicon)</li>
    <li><strong>Python</strong> 3.8+</li>
    <li><strong>Disk:</strong> ~500MB per song for intermediate files (deletable after export)</li>
    <li><strong>RAM:</strong> 8GB minimum, 16GB recommended</li>
  </ul>
</section>

<footer style="margin-top: var(--space-xxl); padding-top: var(--space-lg); border-top: 2px solid var(--color-linen); color: var(--color-text-muted); font-size: 14px;">
  <p>Originally built for the Actors Garden youth musical theater program. Built with Claude Code.</p>
</footer>

</div>

<script>
function downloadFile(filename, content) {
  var blob = new Blob([content], { type: 'text/plain' });
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(a.href);
}

function downloadSetup() {
  var script = [
    '#!/bin/bash',
    '# stem-setup.sh — Install everything needed for the stem splitting pipeline',
    '#',
    '# Usage: bash stem-setup.sh',
    '# Tested on macOS 12+ (Intel and Apple Silicon)',
    '',
    'set -euo pipefail',
    '',
    'GREEN="\\033[0;32m"; RED="\\033[0;31m"; DIM="\\033[2m"; NC="\\033[0m"',
    'ok()  { echo -e "${GREEN}+${NC}  $*"; }',
    'err() { echo -e "${RED}x${NC}  $*"; }',
    'dim() { echo -e "${DIM}   $*${NC}"; }',
    '',
    'echo ""',
    'echo "=== Stem Splitting Pipeline — Setup ==="',
    'echo ""',
    '',
    '# ── Homebrew ──────────────────────────────────────────────────',
    'if ! command -v brew &> /dev/null; then',
    '  err "Homebrew not found. Install it first:"',
    '  dim "https://brew.sh"',
    '  exit 1',
    'fi',
    'ok "Homebrew"',
    '',
    '# ── FFmpeg ────────────────────────────────────────────────────',
    'if command -v ffmpeg &> /dev/null; then',
    '  ok "FFmpeg (already installed)"',
    'else',
    '  echo "  Installing FFmpeg..."',
    '  brew install ffmpeg',
    '  ok "FFmpeg"',
    'fi',
    '',
    '# ── yt-dlp ────────────────────────────────────────────────────',
    'if command -v yt-dlp &> /dev/null; then',
    '  ok "yt-dlp (already installed)"',
    'else',
    '  echo "  Installing yt-dlp..."',
    '  brew install yt-dlp',
    '  ok "yt-dlp"',
    'fi',
    '',
    '# ── Rubber Band (optional, for pitch shifting) ───────────────',
    'if command -v rubberband &> /dev/null || command -v rubberband-cli &> /dev/null; then',
    '  ok "Rubber Band (already installed)"',
    'else',
    '  echo "  Installing Rubber Band..."',
    '  brew install rubberband',
    '  ok "Rubber Band"',
    'fi',
    '',
    '# ── Python venv + Demucs ─────────────────────────────────────',
    'VENV_DIR="${DEMUCS_VENV:-$HOME/demucs-env}"',
    '',
    'if [[ -f "$VENV_DIR/bin/activate" ]]; then',
    '  source "$VENV_DIR/bin/activate"',
    '  if command -v demucs &> /dev/null; then',
    '    ok "Demucs (already installed in $VENV_DIR)"',
    '    deactivate',
    '  else',
    '    echo "  Venv exists but Demucs missing. Installing..."',
    '    pip install demucs',
    '    ok "Demucs"',
    '    deactivate',
    '  fi',
    'else',
    '  echo "  Creating Python venv at $VENV_DIR..."',
    '  python3 -m venv "$VENV_DIR"',
    '  source "$VENV_DIR/bin/activate"',
    '  echo "  Installing Demucs (this may take a minute)..."',
    '  pip install demucs',
    '  ok "Demucs (installed in $VENV_DIR)"',
    '  deactivate',
    'fi',
    '',
    '# ── Create folder structure ──────────────────────────────────',
    'PROJECT_DIR="${1:-./stem-pipeline}"',
    'mkdir -p "$PROJECT_DIR"/{01-Source,02-Stems,03-Shifted,04-Cut,05-Lead-Backing,06-Final,logs}',
    'ok "Folder structure created at $PROJECT_DIR/"',
    '',
    '# ── Done ─────────────────────────────────────────────────────',
    'echo ""',
    'echo "=== Setup complete ==="',
    'echo ""',
    'echo "Next steps:"',
    'echo "  1. Open stem-pipeline-prompt.md"',
    'echo "  2. Fill in your song list"',
    'echo "  3. Paste the prompt into Claude Code or another coding LLM"',
    'echo "  4. Run the generated pipeline script"',
    'echo ""',
  ].join('\n');

  downloadFile('stem-setup.sh', script);
}

function downloadPrompt() {
  var prompt = [
    '# Stem Splitting Pipeline — LLM Prompt',
    '',
    'Paste this entire file into Claude Code, Cursor, or any coding LLM.',
    'Fill in the SONGS section below first.',
    '',
    '---',
    '',
    '## What I Need',
    '',
    'Build me a bash script that processes a list of songs through an audio',
    'stem splitting pipeline. The script should:',
    '',
    '1. Download source audio from YouTube as WAV (using yt-dlp)',
    '2. Split each song into vocals + instrumentals using Demucs',
    '3. Generate four versions of each song:',
    '   - Full Mix (original audio)',
    '   - Half Vox (instrumentals + vocals at 50% volume)',
    '   - Ghost Vox (instrumentals + vocals at 10% volume)',
    '   - Karaoke (instrumentals only)',
    '4. Normalize all output to -14 LUFS',
    '5. Export as WAV (or MP3 if I specify)',
    '',
    '## My Songs',
    '',
    'Replace these examples with your actual songs.',
    'Format: slug | Display Name | YouTube URL',
    '',
    '```',
    'my-shot | My Shot | https://youtu.be/Ic7NqP_YGlg',
    'dear-theodosia | Dear Theodosia | https://youtu.be/TKpJjdKcjeo',
    'how-far-ill-go | How Far I\'ll Go | https://youtu.be/cPAbx5kgCJo',
    '```',
    '',
    '## My Setup',
    '',
    '- **Working directory:** [your project folder, e.g. ~/my-show/]',
    '- **OS:** macOS (Apple Silicon / Intel)',
    '- **Demucs venv:** ~/demucs-env',
    '- **Tools installed:** ffmpeg, yt-dlp, demucs',
    '  (If not installed yet, run stem-setup.sh first)',
    '',
    '## Optional Features (delete any you don\'t need)',
    '',
    '- [ ] **Pitch shifting:** Some songs need to be transposed.',
    '      List which songs and how many semitones (e.g., "dear-theodosia: +5")',
    '      Use Rubber Band. Shift vocals and instrumentals separately.',
    '      Enable --formant for shifts of 3+ semitones.',
    '',
    '- [ ] **Cutting/trimming:** Some songs need sections removed.',
    '      List timestamps (e.g., "my-shot: keep 0:00-1:15, 2:30-end")',
    '',
    '- [ ] **Lead/backing separation:** Split vocals further into lead vs backing.',
    '      Uses audio-separator package. List which songs need this.',
    '',
    '## Technical Requirements',
    '',
    'These are non-negotiable. The LLM should follow all of them:',
    '',
    '- **Idempotent steps.** Every step must check if its output already exists',
    '  and skip completed work. Re-running the script after adding one new song',
    '  should only process that song.',
    '',
    '- **Step-based routing.** The script should accept a step argument:',
    '  `./pipeline.sh check` (verify tools)',
    '  `./pipeline.sh step1` (download)',
    '  `./pipeline.sh step2` (stems)',
    '  `./pipeline.sh step6` (mix + normalize + export)',
    '  `./pipeline.sh status` (show progress grid)',
    '',
    '- **Logged output.** All tool output goes to per-song log files in a logs/',
    '  folder. This prevents long ffmpeg/demucs output from flooding the terminal.',
    '',
    '- **Two-stem mode.** Use `demucs --two-stems vocals -n htdemucs`.',
    '  Do NOT use 4-stem mode unless I specifically ask for drums/bass/other.',
    '',
    '- **Two-pass loudnorm.** Single-pass overshoots. Pass 1 measures with',
    '  `loudnorm=print_format=json`, pass 2 applies the measured values with',
    '  `linear=true`.',
    '',
    '- **normalize=0 in amix.** When mixing vocal levels (half/ghost), use',
    '  `amix=inputs=2:duration=first:normalize=0` to prevent FFmpeg from',
    '  auto-reducing the instrumental volume.',
    '',
    '- **Folder structure:**',
    '  ```',
    '  [project]/01-Source/      # Downloaded WAVs',
    '  [project]/02-Stems/       # Demucs output per song',
    '  [project]/03-Shifted/     # Pitch-shifted (if needed)',
    '  [project]/04-Cut/         # Trimmed (if needed)',
    '  [project]/05-Lead-Backing/ # Lead/backing (if needed)',
    '  [project]/06-Final/       # Normalized exports',
    '  [project]/logs/           # Execution logs',
    '  ```',
    '',
    '## Output',
    '',
    'Generate a single bash script file called `pipeline.sh` that I can run',
    'immediately. Include the song configuration at the top of the script',
    'so I can edit it later without re-prompting.',
    '',
  ].join('\n');

  downloadFile('stem-pipeline-prompt.md', prompt);
}
</script>

</body>
</html>
